sudo: required

services:
- docker

language: node_js
node_js: node

# deploy:
#   provider: npm
#   email: folkvir@outlook.fr
#   api_key: $NPM
#   on:
#     tags: true
#     repo: RAN3D/foglet-core
# notifications:
#   email: false
#
# deploy:
#   provider: pages
#   skip-cleanup: true
#   github-token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
#   keep-history: true
#   local-dir: docs
#   on:
#     branch: master

script:
- cd ./tests/signaling-server/
- docker build -t signaling .
- docker run -d -p 5000:5000 --name signaling -e "PORT=5000" -e "HOST=localhost" signaling
- cd ../../
- npm run build:debug
- npm run build:prod
- npm run test
- npm run doc:build
- docker kill signaling
- docker rm signaling
- docker rmi signaling

before_deploy:
  - cd tests/signaling-server
  - npm install
deploy:
  provider: heroku
  api_key: $HEROKU_AUTH_TOKEN
  app: signaling-v2
  on:
    branch: foglet-rework
after_deploy:
  - echo "Deploy signaling-server to heroku finished. Return to root dir"
  - cd ../..
